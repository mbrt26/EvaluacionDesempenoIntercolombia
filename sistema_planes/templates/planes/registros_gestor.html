{% extends 'base.html' %}
{% load plan_tags %}

{% block title %}Gestor de planes de mejoramiento{% endblock %}

{% block extra_css %}
<style>
    .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        border: 1px solid #ddd;
        border-left: 4px solid;
        padding: 15px;
        border-radius: 4px;
        text-align: center;
    }

    .stat-card.blue { border-left-color: #3498db; }
    .stat-card.red { border-left-color: #e74c3c; }
    .stat-card.yellow { border-left-color: #f39c12; }
    .stat-card.green { border-left-color: #27ae60; }

    .stat-number {
        font-size: 28px;
        font-weight: bold;
        color: #2c3e50;
    }

    .stat-label {
        color: #7f8c8d;
        font-size: 12px;
        margin-top: 5px;
    }

    .action-buttons {
        margin-bottom: 20px;
        text-align: right;
    }

    .action-buttons .btn {
        margin-left: 10px;
    }
</style>
{% endblock %}

{% block content %}
<h1 class="mb-4">üìä Gestor de planes de mejoramiento</h1>

<div class="action-buttons">
    <a href="{% url 'gestor_crear_proveedor' %}" class="btn btn-primary">
        <i class="bi bi-building"></i> Nuevo Proveedor
    </a>
    <a href="{% url 'gestor_cargar_evaluacion' %}" class="btn btn-success">
        <i class="bi bi-cloud-upload"></i> Cargar Evaluaci√≥n
    </a>
    <a href="{% url 'gestor_estadisticas' %}" class="btn btn-info">
        <i class="bi bi-bar-chart"></i> Estad√≠sticas
    </a>
</div>

<!-- Estad√≠sticas -->
<div class="stats">
    <div class="stat-card blue">
        <div class="stat-number">{{ estadisticas.total }}</div>
        <div class="stat-label">Total Proveedores</div>
    </div>
    <div class="stat-card red">
        <div class="stat-number">{{ estadisticas.requieren_plan }}</div>
        <div class="stat-label">Requieren Plan</div>
    </div>
    <div class="stat-card yellow">
        <div class="stat-number">{{ estadisticas.pendientes }}</div>
        <div class="stat-label">Planes Pendientes</div>
    </div>
    <div class="stat-card green">
        <div class="stat-number">{{ estadisticas.aprobados }}</div>
        <div class="stat-label">Planes Aprobados</div>
    </div>
</div>

<!-- Resumen del Flujo de Estados -->
<div class="card mb-4 border-info">
    <div class="card-header bg-info text-white">
        <h5 class="mb-0">
            <i class="bi bi-info-circle"></i> Gu√≠a de Estados del Sistema
            <button class="btn btn-sm btn-light float-end" type="button" data-bs-toggle="collapse" data-bs-target="#guiaEstados">
                <i class="bi bi-chevron-down"></i> Ver/Ocultar
            </button>
        </h5>
    </div>
    <div class="collapse" id="guiaEstados">
        <div class="card-body">
            <div class="row">
                <!-- Columna 1: Estados Iniciales y en Proceso -->
                <div class="col-md-6">
                    <h6 class="text-primary mb-3"><i class="bi bi-arrow-right-circle"></i> Estados en Proceso</h6>

                    <div class="mb-3 p-2 border-start border-secondary border-3">
                        <strong><span class="badge bg-secondary">‚ö† SIN PLAN</span> Sin Plan</strong>
                        <p class="mb-0 small text-muted">El proveedor requiere presentar un plan de mejoramiento pero a√∫n no lo ha cargado. Esperando acci√≥n del proveedor.</p>
                    </div>

                    <div class="mb-3 p-2 border-start border-info border-3">
                        <strong><span class="badge bg-info">‚Üí ENVIADO</span> Enviado</strong>
                        <p class="mb-0 small text-muted">El proveedor envi√≥ el plan. Est√° en cola para revisi√≥n por parte del t√©cnico.</p>
                    </div>

                    <div class="mb-3 p-2 border-start border-danger border-3">
                        <strong><span class="badge bg-danger">! AJUSTES</span> Requiere Ajustes</strong>
                        <p class="mb-0 small text-muted">El t√©cnico solicit√≥ ajustes al plan. El proveedor debe corregir y reenviar.</p>
                    </div>

                    <div class="mb-3 p-2 border-start border-warning border-3">
                        <strong><span class="badge bg-warning text-dark">‚è≥ EN REVISI√ìN</span> En Revisi√≥n</strong>
                        <p class="mb-0 small text-muted">El plan est√° siendo revisado por el t√©cnico o gestor.</p>
                    </div>
                </div>

                <!-- Columna 2: Estados Finales -->
                <div class="col-md-6">
                    <h6 class="text-success mb-3"><i class="bi bi-flag-fill"></i> Estados Finales (FIN del Proceso)</h6>

                    <div class="mb-3 p-2 border-start border-success border-3">
                        <strong><span class="badge bg-success">‚úì APROBADO</span> Aprobado / PM Radicado</strong>
                        <p class="mb-0 small text-muted"><strong>FIN:</strong> El plan fue aprobado y radicado exitosamente. Proceso completado satisfactoriamente.</p>
                    </div>

                    <div class="mb-3 p-2 border-start border-danger border-3">
                        <strong><span class="badge bg-danger">‚úó RECHAZADO</span> Rechazado por Proveedor</strong>
                        <p class="mb-0 small text-muted">El proveedor rechaz√≥ voluntariamente continuar con el proceso. Requiere radicaci√≥n de cancelaci√≥n por t√©cnico.</p>
                    </div>

                    <div class="mb-3 p-2 border-start border-dark border-3">
                        <strong><span class="badge bg-dark">‚úì CANCELADO</span> Cancelaci√≥n Radicada</strong>
                        <p class="mb-0 small text-muted"><strong>FIN:</strong> El rechazo del proveedor fue radicado formalmente. Proceso cerrado.</p>
                    </div>

                    <div class="mb-3 p-2 border-start border-secondary border-3">
                        <strong><span class="badge bg-secondary">‚è± NO RECIBIDO</span> No Recibido (Vencimiento)</strong>
                        <p class="mb-0 small text-muted"><strong>FIN:</strong> Venci√≥ el plazo de 30 d√≠as sin recibir el plan. Proceso cerrado autom√°ticamente.</p>
                    </div>

                    <div class="mb-3 p-2 border-start border-primary border-3">
                        <strong><span class="badge bg-primary">‚ö° PM REEVALUADO</span> PM Reevaluado (‚â•80)</strong>
                        <p class="mb-0 small text-muted"><strong>FIN:</strong> El proveedor alcanz√≥ puntaje ‚â•80 en reevaluaci√≥n. Proceso exitoso.</p>
                    </div>

                    <div class="mb-3 p-2 border-start border-danger border-3">
                        <strong><span class="badge bg-danger">‚ö† FALTA √âTICA</span> Falta de √âtica</strong>
                        <p class="mb-0 small text-muted"><strong>FIN:</strong> Incumplimiento grave detectado. Proceso finalizado con sanci√≥n.</p>
                    </div>
                </div>
            </div>

            <hr class="my-3">

            <div class="alert alert-info mb-0">
                <h6><i class="bi bi-lightbulb"></i> Flujo General del Proceso:</h6>
                <ol class="mb-0 small">
                    <li><strong>Evaluaci√≥n:</strong> Se eval√∫a al proveedor. Si puntaje &lt; 80 ‚Üí requiere plan de mejoramiento</li>
                    <li><strong>Notificaci√≥n:</strong> Se env√≠a carta firmada al proveedor con fecha l√≠mite (30 d√≠as)</li>
                    <li><strong>Presentaci√≥n:</strong> Proveedor carga plan ‚Üí Estado: <span class="badge bg-info">ENVIADO</span></li>
                    <li><strong>Revisi√≥n:</strong> T√©cnico revisa ‚Üí puede aprobar, solicitar ajustes, o rechazar</li>
                    <li><strong>Iteraciones:</strong> Ciclos de ajustes hasta aprobar (5.1, 5.2, 5.3...)</li>
                    <li><strong>Finalizaci√≥n:</strong> El proceso termina en uno de 5 estados finales:
                        <ul>
                            <li>‚úÖ PM Radicado (exitoso)</li>
                            <li>‚ùå Cancelaci√≥n Radicada (rechazo voluntario)</li>
                            <li>‚è± No Recibido (vencimiento)</li>
                            <li>‚ö° PM Reevaluado (puntaje ‚â•80)</li>
                            <li>‚ö† Falta √âtica (sanci√≥n)</li>
                        </ul>
                    </li>
                </ol>
            </div>
        </div>
    </div>
</div>

<h2>üìã Listado de Proveedores</h2>

<!-- Filtros -->
<div class="card mb-3">
    <div class="card-header bg-secondary text-white">
        <h5 class="mb-0"><i class="bi bi-funnel"></i> Filtros de B√∫squeda</h5>
    </div>
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-3">
                <label class="form-label"><strong>Proveedor (Raz√≥n Social o NIT)</strong></label>
                <input type="text" name="busqueda" class="form-control" placeholder="Buscar proveedor..." value="{{ filtros.busqueda }}">
            </div>
            <div class="col-md-2">
                <label class="form-label"><strong>Nota</strong></label>
                <select name="puntaje" class="form-select">
                    <option value="">Todas</option>
                    <option value="60_80" {% if filtros.puntaje == '60_80' %}selected{% endif %}>Aceptable (60-79)</option>
                    <option value="bajo_60" {% if filtros.puntaje == 'bajo_60' %}selected{% endif %}>Cr√≠tica (&lt;60)</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label"><strong>Estado Plan</strong></label>
                <select name="estado" class="form-select">
                    <option value="">Todos</option>
                    <option value="SIN_PLAN" {% if filtros.estado == 'SIN_PLAN' %}selected{% endif %}>Sin Plan</option>
                    <option value="NO_REQUIERE" {% if filtros.estado == 'NO_REQUIERE' %}selected{% endif %}>No Requiere</option>
                    <option value="BORRADOR" {% if filtros.estado == 'BORRADOR' %}selected{% endif %}>Borrador</option>
                    <option value="ENVIADO" {% if filtros.estado == 'ENVIADO' %}selected{% endif %}>Enviado</option>
                    <option value="EN_REVISION" {% if filtros.estado == 'EN_REVISION' %}selected{% endif %}>En Revisi√≥n</option>
                    <option value="REQUIERE_AJUSTES" {% if filtros.estado == 'REQUIERE_AJUSTES' %}selected{% endif %}>Requiere Ajustes</option>
                    <option value="APROBADO" {% if filtros.estado == 'APROBADO' %}selected{% endif %}>Aprobado</option>
                    <option value="RECHAZADO" {% if filtros.estado == 'RECHAZADO' %}selected{% endif %}>Rechazado</option>
                </select>
            </div>
            <div class="col-md-3 d-flex align-items-end">
                <button type="submit" class="btn btn-primary me-2">
                    <i class="bi bi-search"></i> Filtrar
                </button>
                {% if filtros.busqueda or filtros.puntaje or filtros.estado %}
                <a href="{% url 'gestor_registros' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-x-circle"></i> Limpiar
                </a>
                {% endif %}
            </div>
        </form>
    </div>
</div>

<!-- Resultados -->
<div class="alert alert-info">
    <i class="bi bi-info-circle"></i>
    Mostrando <strong>{{ page_obj.paginator.count }}</strong> registro(s)
    {% if filtros.busqueda or filtros.estado or filtros.puntaje or filtros.requiere_plan %}
        (filtrados)
    {% endif %}
</div>

<div class="table-responsive">
    <table class="table table-hover">
        <thead class="table-dark">
            <tr>
                <th>Proveedor</th>
                <th class="text-center">Fecha de Notificaci√≥n</th>
                <th class="text-center">Fecha L√≠mite Plan</th>
                <th class="text-center">Puntaje</th>
                <th class="text-center">√öltimo Proceso</th>
                <th class="text-center">Estado Actual</th>
                <th class="text-center">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for item in datos %}
            <tr>
                <td>
                    <strong style="color: #2c3e50;">{{ item.proveedor.razon_social }}</strong><br>
                    <small class="text-muted">NIT: {{ item.proveedor.nit }}</small><br>
                    <small class="text-muted">üìß {{ item.proveedor.email }}</small>
                </td>
                <td class="text-center">
                    {% if item.evaluacion %}
                        {% if item.evaluacion.fecha_cambio_estado_flujo %}
                            <small>{{ item.evaluacion.fecha_cambio_estado_flujo|date:"d/m/Y H:i" }}</small>
                        {% elif item.evaluacion.fecha_cambio_estado_firma %}
                            <small>{{ item.evaluacion.fecha_cambio_estado_firma|date:"d/m/Y H:i" }}</small>
                        {% else %}
                            <small class="text-muted">‚Äî</small>
                        {% endif %}
                    {% else %}
                        <small class="text-muted">‚Äî</small>
                    {% endif %}
                </td>
                <td class="text-center">
                    {% if item.evaluacion %}
                        {% if item.evaluacion.fecha_cambio_estado_flujo %}
                            <small>{{ item.evaluacion.fecha_cambio_estado_flujo|add_days:30|date:"d/m/Y" }}</small>
                        {% elif item.evaluacion.fecha_cambio_estado_firma %}
                            <small>{{ item.evaluacion.fecha_cambio_estado_firma|add_days:30|date:"d/m/Y" }}</small>
                        {% else %}
                            <small class="text-muted">‚Äî</small>
                        {% endif %}
                    {% else %}
                        <small class="text-muted">‚Äî</small>
                    {% endif %}
                </td>
                <td class="text-center">
                    {% if item.evaluacion %}
                        <span class="badge {% if item.evaluacion.puntaje >= 80 %}bg-success{% elif item.evaluacion.puntaje >= 60 %}bg-warning text-dark{% else %}bg-danger{% endif %}" style="font-size: 16px; padding: 8px 12px;">
                            {{ item.evaluacion.puntaje }}
                        </span>
                    {% else %}
                        <span class="badge bg-secondary" style="font-size: 16px; padding: 8px 12px;">
                            ‚Äî
                        </span>
                    {% endif %}
                </td>
                <td class="text-center">
                    {% if item.plan %}
                        {% if item.plan.estado == 'PM_RADICADO' or item.plan.estado == 'APROBADO' %}
                            <span class="badge bg-success">7Ô∏è‚É£ Plan Radicado</span>
                            <br><small class="text-success">FIN - Exitoso</small>
                        {% elif item.plan.estado == 'CANCELACION_RADICADA' %}
                            <span class="badge bg-dark">8Ô∏è‚É£ Cancelaci√≥n Radicada</span>
                            <br><small class="text-muted">FIN - Cancelado</small>
                        {% elif item.plan.estado == 'NO_RECIBIDO' %}
                            <span class="badge bg-secondary">‚è± No Recibido</span>
                            <br><small class="text-muted">FIN - Vencimiento</small>
                        {% elif item.plan.estado == 'PM_REEVALUADO' %}
                            <span class="badge bg-primary">‚ö° Reevaluado</span>
                            <br><small class="text-success">FIN - Puntaje ‚â•80</small>
                        {% elif item.plan.estado == 'FALTA_ETICA' %}
                            <span class="badge bg-danger">‚ö† Falta de √âtica</span>
                            <br><small class="text-danger">FIN - Sanci√≥n</small>
                        {% elif item.plan.estado == 'RECHAZADO' %}
                            <span class="badge bg-danger">8Ô∏è‚É£.1 Rechazado</span>
                            <br><small class="text-muted">Requiere radicaci√≥n</small>
                        {% elif item.plan.estado == 'EN_RADICACION' %}
                            <span class="badge bg-success">6Ô∏è‚É£ Aprobado</span>
                            <br><small class="text-muted">Pendiente radicaci√≥n</small>
                        {% elif item.plan.estado == 'ENVIADO' %}
                            <span class="badge bg-info">5Ô∏è‚É£.1 Plan Enviado</span>
                            <br><small class="text-muted">En revisi√≥n</small>
                        {% elif item.plan.estado == 'REQUIERE_AJUSTES' or item.plan.estado == 'SOLICITUD_AJUSTES' %}
                            <span class="badge bg-warning text-dark">5Ô∏è‚É£.2 Requiere Ajustes</span>
                            <br><small class="text-muted">Acci√≥n del proveedor</small>
                        {% elif item.plan.estado == 'BORRADOR' %}
                            <span class="badge bg-secondary">4Ô∏è‚É£ Editando Plan</span>
                            <br><small class="text-muted">Proveedor trabajando</small>
                        {% else %}
                            <span class="badge bg-secondary">{{ item.plan.get_estado_display }}</span>
                        {% endif %}
                    {% else %}
                        {% if item.evaluacion %}
                            {% if item.requiere_plan %}
                                {% if item.evaluacion.estado_firma == 'FIRMADO' %}
                                    <span class="badge bg-info">3Ô∏è‚É£ Carta Enviada</span>
                                    <br><small class="text-muted">Esperando plan</small>
                                {% elif item.evaluacion.estado_firma == 'PROCESO_FIRMAS' %}
                                    <span class="badge bg-warning text-dark">2Ô∏è‚É£ Proceso de Firmas</span>
                                    <br><small class="text-muted">Pendiente firmas</small>
                                {% else %}
                                    <span class="badge bg-danger">1Ô∏è‚É£ Evaluaci√≥n Completada</span>
                                    <br><small class="text-muted">Requiere plan</small>
                                {% endif %}
                            {% else %}
                                <span class="badge bg-success">‚úì No Requiere Plan</span>
                                <br><small class="text-success">Puntaje ‚â•80</small>
                            {% endif %}
                        {% else %}
                            <span class="badge bg-secondary">Sin evaluaci√≥n</span>
                            <br><small class="text-muted">No evaluado</small>
                        {% endif %}
                    {% endif %}
                </td>
                <td class="text-center">
                    {% if item.plan %}
                        {% if item.plan.estado == 'PM_RADICADO' or item.plan.estado == 'APROBADO' %}
                            <span class="badge bg-success" style="font-size: 14px;">‚úì RADICADO</span>
                        {% elif item.plan.estado == 'CANCELACION_RADICADA' %}
                            <span class="badge bg-dark" style="font-size: 14px;">‚úì CANCELADO</span>
                        {% elif item.plan.estado == 'NO_RECIBIDO' %}
                            <span class="badge bg-secondary" style="font-size: 14px;">‚è± VENCIDO</span>
                        {% elif item.plan.estado == 'PM_REEVALUADO' %}
                            <span class="badge bg-primary" style="font-size: 14px;">‚ö° REEVALUADO</span>
                        {% elif item.plan.estado == 'FALTA_ETICA' %}
                            <span class="badge bg-danger" style="font-size: 14px;">‚ö† FALTA √âTICA</span>
                        {% elif item.plan.estado == 'RECHAZADO' %}
                            <span class="badge bg-danger" style="font-size: 14px;">‚úó RECHAZADO</span>
                        {% elif item.plan.estado == 'EN_RADICACION' %}
                            <span class="badge bg-success" style="font-size: 14px;">‚Üí EN RADICACI√ìN</span>
                        {% elif item.plan.estado == 'ENVIADO' %}
                            <span class="badge bg-info" style="font-size: 14px;">‚Üí ENVIADO</span>
                        {% elif item.plan.estado == 'REQUIERE_AJUSTES' or item.plan.estado == 'SOLICITUD_AJUSTES' %}
                            <span class="badge bg-warning text-dark" style="font-size: 14px;">! AJUSTES</span>
                        {% elif item.plan.estado == 'BORRADOR' %}
                            <span class="badge bg-secondary" style="font-size: 14px;">üìù BORRADOR</span>
                        {% else %}
                            <span class="badge bg-secondary" style="font-size: 14px;">{{ item.plan.get_estado_display|upper }}</span>
                        {% endif %}
                        {% if item.plan.fecha_envio %}
                        <br><small class="text-muted">{{ item.plan.fecha_envio|date:"d/m/Y" }}</small>
                        {% endif %}
                    {% else %}
                        {% if item.evaluacion %}
                            {% if item.requiere_plan %}
                                {% if item.evaluacion.estado_firma == 'FIRMADO' %}
                                    <span class="badge bg-info" style="font-size: 14px;">üì® NOTIFICADO</span>
                                {% elif item.evaluacion.estado_firma == 'PROCESO_FIRMAS' %}
                                    <span class="badge bg-warning text-dark" style="font-size: 14px;">‚úçÔ∏è FIRMANDO</span>
                                {% else %}
                                    <span class="badge bg-danger" style="font-size: 14px;">‚ö† SIN PLAN</span>
                                {% endif %}
                                <br><small class="text-danger">Acci√≥n requerida</small>
                            {% else %}
                                <span class="badge bg-success" style="font-size: 14px;">‚úì APROBADO</span>
                                <br><small class="text-success">Puntaje ‚â•80</small>
                            {% endif %}
                        {% else %}
                            <span class="badge bg-success" style="font-size: 14px;">‚úì NO REQUIERE</span>
                            <br><small class="text-success">Puntaje Satisfactorio</small>
                        {% endif %}
                    {% endif %}
                </td>
                <td class="text-center">
                    {% if item.evaluacion %}
                        <a href="{% url 'proveedor_ver_evaluacion' item.evaluacion.id %}" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-eye"></i> Ver Evaluaci√≥n
                        </a>
                    {% else %}
                        <span class="badge bg-secondary">Sin evaluaci√≥n</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center py-5">
                    <div style="font-size: 48px;">üì≠</div>
                    <p class="text-muted">No se encontraron proveedores con evaluaciones</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Paginaci√≥n -->
{% if page_obj.has_other_pages %}
<nav aria-label="Paginaci√≥n de registros" class="mt-4">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?page=1{% if filtros.busqueda %}&busqueda={{ filtros.busqueda }}{% endif %}{% if filtros.estado %}&estado={{ filtros.estado }}{% endif %}{% if filtros.puntaje %}&puntaje={{ filtros.puntaje }}{% endif %}{% if filtros.requiere_plan %}&requiere_plan={{ filtros.requiere_plan }}{% endif %}" aria-label="Primera">
                <span aria-hidden="true">&laquo;&laquo;</span>
            </a>
        </li>
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if filtros.busqueda %}&busqueda={{ filtros.busqueda }}{% endif %}{% if filtros.estado %}&estado={{ filtros.estado }}{% endif %}{% if filtros.puntaje %}&puntaje={{ filtros.puntaje }}{% endif %}{% if filtros.requiere_plan %}&requiere_plan={{ filtros.requiere_plan }}{% endif %}" aria-label="Anterior">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">&laquo;&laquo;</span>
        </li>
        <li class="page-item disabled">
            <span class="page-link">&laquo;</span>
        </li>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
            <li class="page-item active" aria-current="page">
                <span class="page-link">{{ num }}</span>
            </li>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <li class="page-item">
                <a class="page-link" href="?page={{ num }}{% if filtros.busqueda %}&busqueda={{ filtros.busqueda }}{% endif %}{% if filtros.estado %}&estado={{ filtros.estado }}{% endif %}{% if filtros.puntaje %}&puntaje={{ filtros.puntaje }}{% endif %}{% if filtros.requiere_plan %}&requiere_plan={{ filtros.requiere_plan }}{% endif %}">{{ num }}</a>
            </li>
            {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if filtros.busqueda %}&busqueda={{ filtros.busqueda }}{% endif %}{% if filtros.estado %}&estado={{ filtros.estado }}{% endif %}{% if filtros.puntaje %}&puntaje={{ filtros.puntaje }}{% endif %}{% if filtros.requiere_plan %}&requiere_plan={{ filtros.requiere_plan }}{% endif %}" aria-label="Siguiente">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if filtros.busqueda %}&busqueda={{ filtros.busqueda }}{% endif %}{% if filtros.estado %}&estado={{ filtros.estado }}{% endif %}{% if filtros.puntaje %}&puntaje={{ filtros.puntaje }}{% endif %}{% if filtros.requiere_plan %}&requiere_plan={{ filtros.requiere_plan }}{% endif %}" aria-label="√öltima">
                <span aria-hidden="true">&raquo;&raquo;</span>
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">&raquo;</span>
        </li>
        <li class="page-item disabled">
            <span class="page-link">&raquo;&raquo;</span>
        </li>
        {% endif %}
    </ul>
    <p class="text-center text-muted">
        P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }} ({{ estadisticas.total }} registros totales, mostrando {{ page_obj.object_list|length }} en esta p√°gina)
    </p>
</nav>
{% endif %}
{% endblock %}
